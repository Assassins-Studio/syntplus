<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Synt+</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter&family=Roboto+Mono&display=swap');
  :root {
    --bg: #121212;
    --panel-bg: #1e1e1e;
    --accent: #00bcd4;
    --accent2: #2979ff;
    --text-primary: #e0e0e0;
    --text-secondary: #888;
    --error-red: #ff5555;
    --border-radius: 8px;
    --transition: all 0.25s ease-in-out;
  }
  body, html {
    margin: 0; padding: 0; height: 100%;
    background: var(--bg);
    color: var(--text-primary);
    font-family: 'Inter', sans-serif;
    overflow: hidden;
    user-select: none;
  }
  #welcome-screen {
    position: fixed; inset: 0;
    background: var(--bg);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    animation: fadeOut 1.2s ease forwards;
    animation-delay: 1.8s;
  }
  #welcome-screen.hide {
    display: none;
  }
  @keyframes fadeOut {
    to { opacity: 0; visibility: hidden; }
  }
  #logo {
    width: 96px; height: 96px;
    margin-bottom: 20px;
  }
  #logo svg {
    fill: var(--accent);
    filter: drop-shadow(0 0 6px var(--accent));
  }
  #welcome-text {
    font-size: 1.6rem;
    letter-spacing: 0.05em;
    color: var(--accent2);
    font-weight: 700;
  }

  /* Layout */
  #app {
    display: grid;
    grid-template-rows: 48px 1fr 32px;
    height: 100vh;
    width: 100vw;
  }
  header {
    background: var(--panel-bg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    user-select: none;
    border-bottom: 1px solid #222;
  }
  header .left, header .right {
    display: flex;
    align-items: center;
  }
  header h1 {
    font-family: 'Roboto Mono', monospace;
    font-weight: 700;
    font-size: 1.4rem;
    color: var(--accent);
    margin: 0 12px 0 8px;
    user-select: none;
  }
  button, select {
    background: transparent;
    border: 1.5px solid var(--accent);
    color: var(--accent);
    font-family: 'Roboto Mono', monospace;
    font-weight: 600;
    cursor: pointer;
    border-radius: var(--border-radius);
    padding: 6px 12px;
    margin-left: 8px;
    transition: var(--transition);
  }
  button:hover, select:hover {
    background: var(--accent2);
    border-color: var(--accent2);
    color: #fff;
  }
  button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
  select {
    min-width: 120px;
  }
  main {
    display: flex;
    height: 100%;
    background: var(--panel-bg);
  }
  #editor {
    flex: 1;
    border-right: 1px solid #222;
    font-family: 'Roboto Mono', monospace;
  }
  #console {
    flex-basis: 35%;
    background: #0e0e0e;
    padding: 12px 16px;
    color: var(--text-primary);
    font-family: 'Roboto Mono', monospace;
    overflow-y: auto;
    white-space: pre-wrap;
    line-height: 1.4;
    font-size: 14px;
  }
  #console.error {
    color: var(--error-red);
    font-weight: 700;
  }
  footer {
    height: 32px;
    background: var(--panel-bg);
    border-top: 1px solid #222;
  }

  /* Settings Modal */
  #settings-modal {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%) scale(0);
    background: var(--panel-bg);
    border-radius: var(--border-radius);
    box-shadow: 0 0 12px rgba(0,0,0,0.8);
    color: var(--text-primary);
    padding: 20px 30px;
    width: 300px;
    z-index: 10000;
    transition: transform 0.25s ease;
    user-select: none;
  }
  #settings-modal.show {
    transform: translate(-50%, -50%) scale(1);
  }
  #settings-modal h2 {
    margin-top: 0;
    font-weight: 700;
    font-family: 'Roboto Mono', monospace;
    color: var(--accent);
    margin-bottom: 20px;
    user-select: none;
  }
  #settings-modal label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    font-family: 'Roboto Mono', monospace;
  }
  #settings-modal select {
    width: 100%;
    margin-bottom: 16px;
  }
  #settings-modal button.close-btn {
    background: var(--accent);
    border: none;
    color: #fff;
    padding: 8px 16px;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-weight: 700;
    font-family: 'Roboto Mono', monospace;
    width: 100%;
    transition: var(--transition);
  }
  #settings-modal button.close-btn:hover {
    background: var(--accent2);
  }

  /* Scrollbar */
  #console::-webkit-scrollbar {
    width: 8px;
  }
  #console::-webkit-scrollbar-thumb {
    background-color: var(--accent);
    border-radius: 4px;
  }

  /* Icon Buttons */
  .icon-btn {
    border: none;
    background: transparent;
    cursor: pointer;
    margin-left: 12px;
    padding: 4px;
    transition: var(--transition);
    color: var(--accent);
  }
  .icon-btn:hover {
    color: var(--accent2);
  }

</style>

<!-- Monaco editor & Pyodide -->
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs/loader.js"></script>
<script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>

</head>
<body>

<!-- Welcome Screen -->
<div id="welcome-screen" aria-live="polite" aria-label="Loading Synt plus editor">
  <div id="logo" aria-hidden="true">
    <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" >
      <circle cx="32" cy="32" r="30" stroke="none" fill="var(--accent)" />
      <polygon points="24,18 48,32 24,46" fill="#121212"/>
    </svg>
  </div>
  <div id="welcome-text">Loading Synt+...</div>
</div>

<div id="app" style="display:none;">

<header role="banner">
  <div class="left" aria-label="App logo and name">
    <div id="logo" style="width:28px; height:28px;" aria-hidden="true">
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" >
        <circle cx="32" cy="32" r="30" stroke="none" fill="var(--accent)" />
        <polygon points="24,18 48,32 24,46" fill="#121212"/>
      </svg>
    </div>
    <h1>Synt+</h1>
  </div>

  <div class="right" role="navigation" aria-label="Main controls">
    <button id="new-file" title="New File">New</button>
    <button id="open-file" title="Open File">Open</button>
    <button id="save-file" title="Save File">Save</button>
    <button id="run-code" title="Run Code" disabled>Run</button>
    <select id="language-select" aria-label="Select language for syntax highlighting">
      <option value="python" selected>Python</option>
      <option value="javascript">JavaScript</option>
      <option value="cpp">C++</option>
      <option value="csharp">C#</option>
    </select>
    <button id="settings-btn" class="icon-btn" aria-label="Settings">&#9881;</button>
  </div>
</header>

<main role="main">
  <div id="editor" role="region" aria-label="Code editor"></div>
  <pre id="console" role="region" aria-live="polite" aria-label="Output console"></pre>
</main>

<footer role="contentinfo"></footer>

<!-- Settings Modal -->
<div id="settings-modal" role="dialog" aria-modal="true" aria-labelledby="settings-title" tabindex="-1">
  <h2 id="settings-title">Settings</h2>
  <label for="font-size-select">Font Size</label>
  <select id="font-size-select" aria-describedby="fontSizeHelp">
    <option value="12">12 px</option>
    <option value="14" selected>14 px</option>
    <option value="16">16 px</option>
    <option value="18">18 px</option>
    <option value="20">20 px</option>
  </select>

  <label for="theme-select">Editor Theme</label>
  <select id="theme-select">
    <option value="vs-dark" selected>Dark</option>
    <option value="vs-light">Light</option>
  </select>

  <button class="close-btn" id="close-settings-btn">Close</button>
</div>

<script>
  // Monaco Editor setup and pyodide loading
  let editor, pyodide = null;
  let currentLanguage = 'python';

  // DOM references
  const runBtn = document.getElementById('run-code');
  const newFileBtn = document.getElementById('new-file');
  const openFileBtn = document.getElementById('open-file');
  const saveFileBtn = document.getElementById('save-file');
  const languageSelect = document.getElementById('language-select');
  const consoleOutput = document.getElementById('console');
  const settingsBtn = document.getElementById('settings-btn');
  const settingsModal = document.getElementById('settings-modal');
  const closeSettingsBtn = document.getElementById('close-settings-btn');
  const fontSizeSelect = document.getElementById('font-size-select');
  const themeSelect = document.getElementById('theme-select');
  const welcomeScreen = document.getElementById('welcome-screen');
  const app = document.getElementById('app');

  // Initialize Monaco Editor after loader
  require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs' }});
  require(['vs/editor/editor.main'], () => {
    editor = monaco.editor.create(document.getElementById('editor'), {
      value: `# Welcome to Synt+\n# Select language and start coding.`,
      language: currentLanguage,
      theme: 'vs-dark',
      fontSize: 14,
      automaticLayout: true,
      minimap: { enabled: false },
      scrollBeyondLastLine: false,
    });
  });

  // Load Pyodide async
  async function loadPyodideAndReady() {
    consoleOutput.textContent = "Loading Python runtime...";
    pyodide = await loadPyodide({
      indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/",
    });
    runBtn.disabled = false;
    consoleOutput.textContent = "[Ready]";
  }

  // Start loading Pyodide
  loadPyodideAndReady().then(() => {
    // Hide welcome screen after animation
    welcomeScreen.classList.add('hide');
    setTimeout(() => {
      welcomeScreen.style.display = 'none';
      app.style.display = 'grid';
    }, 1200);
  });

  // Language switch
  languageSelect.addEventListener('change', (e) => {
    currentLanguage = e.target.value;
    monaco.editor.setModelLanguage(editor.getModel(), currentLanguage);
    consoleOutput.textContent = `[Language set to ${currentLanguage}]`;
  });

  // New file
  newFileBtn.addEventListener('click', () => {
    editor.setValue('');
    consoleOutput.textContent = '[New file created]';
  });

  // Open file
  openFileBtn.addEventListener('click', () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.synt,text/plain';
    input.onchange = (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        let text = reader.result;
        // Check for language header: //# language:python
        let langMatch = text.match(/^\/\/#\s*language:(\w+)/i);
        if (langMatch) {
          currentLanguage = langMatch[1].toLowerCase();
          if (['python','javascript','cpp','csharp'].includes(currentLanguage)) {
            languageSelect.value = currentLanguage;
            monaco.editor.setModelLanguage(editor.getModel(), currentLanguage);
          }
          text = text.replace(/^\/\/#.*\n/, '');
        } else {
          // no header - ask user for language?
          // For now, do nothing
        }
        editor.setValue(text);
        consoleOutput.textContent = `[Loaded file "${file.name}" with language "${currentLanguage}"]`;
      };
      reader.readAsText(file);
    };
    input.click();
  });

  // Save file
  saveFileBtn.addEventListener('click', () => {
    const code = editor.getValue();
    // Add language header
    const header = `//# language:${currentLanguage}\n`;
    const blob = new Blob([header + code], { type: 'text/plain' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'file.synt';
    a.click();
    URL.revokeObjectURL(a.href);
    consoleOutput.textContent = '[File saved locally]';
  });

  // Run code
  runBtn.addEventListener('click', async () => {
    const code = editor.getValue();
    consoleOutput.textContent = '[Running code...]';

    try {
      if (currentLanguage === 'python') {
        if (!pyodide) {
          consoleOutput.textContent = 'Python runtime is not loaded yet.';
          return;
        }
        const result = await pyodide.runPythonAsync(code);
        consoleOutput.textContent = (result === undefined || result === null) ? '[No output]' : result.toString();
      } else if (currentLanguage === 'javascript') {
        try {
          const result = eval(code);
          consoleOutput.textContent = (result === undefined || result === null) ? '[No output]' : result.toString();
        } catch(e) {
          consoleOutput.textContent = 'Error: ' + e.message;
          consoleOutput.classList.add('error');
          return;
        }
      } else {
        consoleOutput.textContent = `Running ${currentLanguage} is not supported yet.`;
      }
      consoleOutput.classList.remove('error');
    } catch (e) {
      consoleOutput.textContent = 'Error: ' + e.message;
      consoleOutput.classList.add('error');
    }
  });

  // Settings modal toggle
  settingsBtn.addEventListener('click', () => {
    settingsModal.classList.add('show');
    settingsModal.focus();
  });
  closeSettingsBtn.addEventListener('click', () => {
    settingsModal.classList.remove('show');
  });

  // Settings: Font size
  fontSizeSelect.addEventListener('change', () => {
    const size = parseInt(fontSizeSelect.value, 10);
    editor.updateOptions({ fontSize: size });
  });

  // Settings: Theme
  themeSelect.addEventListener('change', () => {
    const theme = themeSelect.value;
    monaco.editor.setTheme(theme);
  });

  // Accessibility: Close settings modal on Escape
  settingsModal.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      settingsModal.classList.remove('show');
    }
  });

</script>

</body>
</html>
